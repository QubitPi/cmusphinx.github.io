<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PocketSphinx: simple.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PocketSphinx
   &#160;<span id="projectnumber">5.0.0</span>
   </div>
   <div id="projectbrief">A small speech recognizer</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">simple.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>Simplest possible example of speech recognition in C.This file shows how to use PocketSphinx to recognize a single input file. To compile it, assuming you have built the library as in <a class="el" href="index.html#unix_install">these directions</a>, you can run: </p><pre class="fragment">cmake --build build --target simple
</pre><p>Alternately, if PocketSphinx is installed system-wide, you can run: </p><pre class="fragment">gcc -o simple simple.c $(pkg-config --libs --cflags pocketsphinx)
</pre><div class="fragment"><div class="line"><span class="comment">/* Example of simple PocketSphinx recognition.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * MIT license (c) 2022, see LICENSE for more information.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Author: David Huggins-Daines &lt;dhdaines@gmail.com&gt;</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="pocketsphinx_8h.html">pocketsphinx.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    <a name="_a0"></a><a class="code" href="structps__decoder__t.html">ps_decoder_t</a> *decoder;</div>
<div class="line">    <a name="_a1"></a><a class="code" href="structps__config__t.html">ps_config_t</a> *config;</div>
<div class="line">    FILE *fh;</div>
<div class="line">    <span class="keywordtype">short</span> *buf;</div>
<div class="line">    <span class="keywordtype">size_t</span> len, nsamples;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Look for a single audio file as input parameter. */</span></div>
<div class="line">    <span class="keywordflow">if</span> (argc &lt; 2)</div>
<div class="line">        <a name="a2"></a><a class="code" href="err_8h.html#abaacffc3c0f14e4dd180b1e38c62c5a0">E_FATAL</a>(<span class="stringliteral">&quot;Usage: %s FILE\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> ((fh = fopen(argv[1], <span class="stringliteral">&quot;rb&quot;</span>)) == NULL)</div>
<div class="line">        <a name="a3"></a><a class="code" href="err_8h.html#acc9aaeb2e0eb21f964913c14403d6795">E_FATAL_SYSTEM</a>(<span class="stringliteral">&quot;Failed to open %s&quot;</span>, argv[1]);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Get the size of the input. */</span></div>
<div class="line">    <span class="keywordflow">if</span> (fseek(fh, 0, SEEK_END) &lt; 0)</div>
<div class="line">        <a class="code" href="err_8h.html#acc9aaeb2e0eb21f964913c14403d6795">E_FATAL_SYSTEM</a>(<span class="stringliteral">&quot;Unable to find end of input file %s&quot;</span>, argv[1]);</div>
<div class="line">    len = ftell(fh);</div>
<div class="line">    rewind(fh);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize configuration from input file. */</span></div>
<div class="line">    config = <a name="a4"></a><a class="code" href="structps__config__t.html#a65588a7f05e8796f722fb7bd7355e57c">ps_config_init</a>(NULL);</div>
<div class="line">    <a name="a5"></a><a class="code" href="structps__config__t.html#ab33df51031c41cdb73794845c33a2d88">ps_default_search_args</a>(config);</div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a6"></a><a class="code" href="structps__config__t.html#a30154c47339a448445f1ca52f63ebdd8">ps_config_soundfile</a>(config, fh, argv[1]) &lt; 0)</div>
<div class="line">        <a class="code" href="err_8h.html#abaacffc3c0f14e4dd180b1e38c62c5a0">E_FATAL</a>(<span class="stringliteral">&quot;Unsupported input file %s\n&quot;</span>, argv[1]);</div>
<div class="line">    <span class="keywordflow">if</span> ((decoder = <a name="a7"></a><a class="code" href="structps__config__t.html#a69b05a7582ee80ff206fb1e4d709bc4c">ps_init</a>(config)) == NULL)</div>
<div class="line">        <a class="code" href="err_8h.html#abaacffc3c0f14e4dd180b1e38c62c5a0">E_FATAL</a>(<span class="stringliteral">&quot;PocketSphinx decoder init failed\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Allocate data (skipping header) */</span></div>
<div class="line">    len -= ftell(fh);</div>
<div class="line">    <span class="keywordflow">if</span> ((buf = malloc(len)) == NULL)</div>
<div class="line">        <a class="code" href="err_8h.html#acc9aaeb2e0eb21f964913c14403d6795">E_FATAL_SYSTEM</a>(<span class="stringliteral">&quot;Unable to allocate %d bytes&quot;</span>, len);</div>
<div class="line">    <span class="comment">/* Read input */</span></div>
<div class="line">    nsamples = fread(buf, <span class="keyword">sizeof</span>(buf[0]), len / <span class="keyword">sizeof</span>(buf[0]), fh);</div>
<div class="line">    <span class="keywordflow">if</span> (nsamples != len / <span class="keyword">sizeof</span>(buf[0]))</div>
<div class="line">        <a class="code" href="err_8h.html#acc9aaeb2e0eb21f964913c14403d6795">E_FATAL_SYSTEM</a>(<span class="stringliteral">&quot;Unable to read %d samples&quot;</span>, len / <span class="keyword">sizeof</span>(buf[0]));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Recognize it! */</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a8"></a><a class="code" href="structps__decoder__t.html#ade3909b1c12c1b70afe284639e70cbff">ps_start_utt</a>(decoder) &lt; 0)</div>
<div class="line">        <a class="code" href="err_8h.html#abaacffc3c0f14e4dd180b1e38c62c5a0">E_FATAL</a>(<span class="stringliteral">&quot;Failed to start processing\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a9"></a><a class="code" href="structps__decoder__t.html#a572ad08651b4caae820d178a12c8f95f">ps_process_raw</a>(decoder, buf, nsamples, FALSE, TRUE) &lt; 0)</div>
<div class="line">        <a class="code" href="err_8h.html#abaacffc3c0f14e4dd180b1e38c62c5a0">E_FATAL</a>(<span class="stringliteral">&quot;ps_process_raw() failed\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a10"></a><a class="code" href="structps__decoder__t.html#ab9339de730713b68cbd68a7f36dc8730">ps_end_utt</a>(decoder) &lt; 0)</div>
<div class="line">        <a class="code" href="err_8h.html#abaacffc3c0f14e4dd180b1e38c62c5a0">E_FATAL</a>(<span class="stringliteral">&quot;Failed to end processing\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Print the result */</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a11"></a><a class="code" href="structps__decoder__t.html#a6846d8c5dc2abfc9e92b6ae553c594b0">ps_get_hyp</a>(decoder, NULL) != NULL)</div>
<div class="line">        printf(<span class="stringliteral">&quot;%s\n&quot;</span>, <a class="code" href="structps__decoder__t.html#a6846d8c5dc2abfc9e92b6ae553c594b0">ps_get_hyp</a>(decoder, NULL));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Clean up */</span></div>
<div class="line">    <span class="keywordflow">if</span> (fclose(fh) &lt; 0)</div>
<div class="line">        <a class="code" href="err_8h.html#acc9aaeb2e0eb21f964913c14403d6795">E_FATAL_SYSTEM</a>(<span class="stringliteral">&quot;Failed to close %s&quot;</span>, argv[1]);</div>
<div class="line">    free(buf);</div>
<div class="line">    <a name="a12"></a><a class="code" href="structps__decoder__t.html#ad8fd9b79ae9f87703af3f4755b3ab567">ps_free</a>(decoder);</div>
<div class="line">    <a name="a13"></a><a class="code" href="structps__config__t.html#a58efc9357b6871c0575be7ea59f326b0">ps_config_free</a>(config);</div>
<div class="line">        </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="astructps__decoder__t_html_a572ad08651b4caae820d178a12c8f95f"><div class="ttname"><a href="structps__decoder__t.html#a572ad08651b4caae820d178a12c8f95f">ps_decoder_t::ps_process_raw</a></div><div class="ttdeci">POCKETSPHINX_EXPORT int ps_process_raw(ps_decoder_t *ps, int16 const *data, size_t n_samples, int no_search, int full_utt)</div></div>
<div class="ttc" id="astructps__config__t_html_a65588a7f05e8796f722fb7bd7355e57c"><div class="ttname"><a href="structps__config__t.html#a65588a7f05e8796f722fb7bd7355e57c">ps_config_t::ps_config_init</a></div><div class="ttdeci">POCKETSPHINX_EXPORT ps_config_t * ps_config_init(const ps_arg_t *defn)</div></div>
<div class="ttc" id="astructps__decoder__t_html_a6846d8c5dc2abfc9e92b6ae553c594b0"><div class="ttname"><a href="structps__decoder__t.html#a6846d8c5dc2abfc9e92b6ae553c594b0">ps_decoder_t::ps_get_hyp</a></div><div class="ttdeci">POCKETSPHINX_EXPORT const char * ps_get_hyp(ps_decoder_t *ps, int32 *out_best_score)</div></div>
<div class="ttc" id="astructps__config__t_html_a30154c47339a448445f1ca52f63ebdd8"><div class="ttname"><a href="structps__config__t.html#a30154c47339a448445f1ca52f63ebdd8">ps_config_t::ps_config_soundfile</a></div><div class="ttdeci">POCKETSPHINX_EXPORT int ps_config_soundfile(ps_config_t *config, FILE *fh, const char *file)</div></div>
<div class="ttc" id="astructps__config__t_html_a58efc9357b6871c0575be7ea59f326b0"><div class="ttname"><a href="structps__config__t.html#a58efc9357b6871c0575be7ea59f326b0">ps_config_t::ps_config_free</a></div><div class="ttdeci">POCKETSPHINX_EXPORT int ps_config_free(ps_config_t *config)</div></div>
<div class="ttc" id="astructps__decoder__t_html_ad8fd9b79ae9f87703af3f4755b3ab567"><div class="ttname"><a href="structps__decoder__t.html#ad8fd9b79ae9f87703af3f4755b3ab567">ps_decoder_t::ps_free</a></div><div class="ttdeci">POCKETSPHINX_EXPORT int ps_free(ps_decoder_t *ps)</div></div>
<div class="ttc" id="astructps__config__t_html"><div class="ttname"><a href="structps__config__t.html">ps_config_t</a></div><div class="ttdoc">configuration object.</div></div>
<div class="ttc" id="aerr_8h_html_acc9aaeb2e0eb21f964913c14403d6795"><div class="ttname"><a href="err_8h.html#acc9aaeb2e0eb21f964913c14403d6795">E_FATAL_SYSTEM</a></div><div class="ttdeci">#define E_FATAL_SYSTEM(...)</div><div class="ttdef"><b>Definition:</b> err.h:89</div></div>
<div class="ttc" id="apocketsphinx_8h_html"><div class="ttname"><a href="pocketsphinx_8h.html">pocketsphinx.h</a></div></div>
<div class="ttc" id="astructps__decoder__t_html_ade3909b1c12c1b70afe284639e70cbff"><div class="ttname"><a href="structps__decoder__t.html#ade3909b1c12c1b70afe284639e70cbff">ps_decoder_t::ps_start_utt</a></div><div class="ttdeci">POCKETSPHINX_EXPORT int ps_start_utt(ps_decoder_t *ps)</div></div>
<div class="ttc" id="astructps__config__t_html_a69b05a7582ee80ff206fb1e4d709bc4c"><div class="ttname"><a href="structps__config__t.html#a69b05a7582ee80ff206fb1e4d709bc4c">ps_config_t::ps_init</a></div><div class="ttdeci">POCKETSPHINX_EXPORT ps_decoder_t * ps_init(ps_config_t *config)</div></div>
<div class="ttc" id="astructps__decoder__t_html"><div class="ttname"><a href="structps__decoder__t.html">ps_decoder_t</a></div><div class="ttdoc">Speech recognizer object.</div></div>
<div class="ttc" id="astructps__decoder__t_html_ab9339de730713b68cbd68a7f36dc8730"><div class="ttname"><a href="structps__decoder__t.html#ab9339de730713b68cbd68a7f36dc8730">ps_decoder_t::ps_end_utt</a></div><div class="ttdeci">POCKETSPHINX_EXPORT int ps_end_utt(ps_decoder_t *ps)</div></div>
<div class="ttc" id="astructps__config__t_html_ab33df51031c41cdb73794845c33a2d88"><div class="ttname"><a href="structps__config__t.html#ab33df51031c41cdb73794845c33a2d88">ps_config_t::ps_default_search_args</a></div><div class="ttdeci">POCKETSPHINX_EXPORT void ps_default_search_args(ps_config_t *config)</div></div>
<div class="ttc" id="aerr_8h_html_abaacffc3c0f14e4dd180b1e38c62c5a0"><div class="ttname"><a href="err_8h.html#abaacffc3c0f14e4dd180b1e38c62c5a0">E_FATAL</a></div><div class="ttdeci">#define E_FATAL(...)</div><div class="ttdef"><b>Definition:</b> err.h:80</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
